<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gérer assetType & virtual_envelop</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;padding:12px}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #ddd;padding:6px;font-size:13px}
    th{background:#f4f4f4}
    input[type=text]{width:100%}
    .controls{margin:8px 0}
    .btn{padding:8px 12px;margin-right:8px}
    .auto-updated{background: #fffbcc !important; transition: background 1s ease;}
  </style>
</head>
<body>
  <h2>Gérer assetType & virtual_envelop (assets aplatis)</h2>
  <div class="controls">
    <button id="reload-btn" class="btn">Recharger cache</button>
    <button id="force-refresh-btn" class="btn">Force refresh</button>
    <button id="save-btn" class="btn">Enregistrer</button>
    <button id="export-csv-btn" class="btn">Exporter CSV</button>
    <button id="add-rule-btn" class="btn">Ajouter règle</button>
    <button id="apply-rules-btn" class="btn">Appliquer règles</button>
    <span id="status"></span>
  </div>
  <div style="margin:8px 0;border:1px dashed #ccc;padding:8px">
    <strong>Règles assetClass (ordre appliqué de haut en bas)</strong>
    <div id="rules-container" style="margin-top:8px"></div>
    <div style="margin-top:8px;font-size:12px;color:#555">Champs de test: <em>assetName, assetType, assetVehicle, institutionName, accountName</em>. Opérateurs: <em>contains, equals, startsWith, regex</em>.</div>
  </div>
  <div style="max-height:70vh;overflow:auto">
    <table id="assets-table">
      <thead>
        <tr>
          <th>holdingId</th>
          <th>accountName</th>
          <th>institutionName</th>
          <th>envelopeType</th>
          <th>assetId</th>
          <th>assetName</th>
          <th>assetClass</th>
          <th>assetType</th>
          <th>assetVehicle</th>
          <th>currentValue</th>
          <th>quantity</th>
          <th>pnl_amount</th>
          <th>virtual_envelop (editable)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <script src="popup_virtual_envelop.js"></script>
</body>
</html>
